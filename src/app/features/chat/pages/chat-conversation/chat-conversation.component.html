<div class="chat-conversation-container">
  <!-- Header -->
  <header class="chat-header">
    <a mat-icon-button routerLink="/chat" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </a>
    
    <div class="recipient-info">
      <div class="avatar" [class.online]="recipient().isOnline">
        {{ recipient().name.charAt(0) }}
      </div>
      <div class="details">
        <h2>{{ recipient().name }}</h2>
        <span class="status">
          @if (recipient().isOnline) {
            <span class="online">Online</span>
          } @else {
            <span class="offline">Offline</span>
          }
        </span>
      </div>
    </div>
    
    <button mat-icon-button class="more-options">
      <mat-icon>more_vert</mat-icon>
    </button>
  </header>

  <!-- Messages -->
  <div class="messages-container">
    @if (isLoading()) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    } @else {
      <div class="messages-list">
        @for (message of messages(); track trackByMessage($index, message)) {
          <div class="message" [class.mine]="message.isMine" [class.theirs]="!message.isMine">
            <div class="message-bubble">
              <p class="message-content">{{ message.content }}</p>
              <span class="message-time">
                {{ formatTime(message.timestamp) }}
                @if (message.isMine) {
                  <mat-icon class="read-status" [class.read]="message.isRead">
                    {{ message.isRead ? 'done_all' : 'done' }}
                  </mat-icon>
                }
              </span>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Input -->
  <footer class="chat-input">
    <mat-form-field appearance="outline" class="message-field">
      <input
        matInput
        placeholder="Type a message..."
        [(ngModel)]="newMessage"
        (keyup.enter)="sendMessage()"
        [disabled]="isSending()"
      />
    </mat-form-field>
    
    <button
      mat-fab
      color="primary"
      (click)="sendMessage()"
      [disabled]="!newMessage.trim() || isSending()"
      class="send-button"
    >
      @if (isSending()) {
        <mat-spinner diameter="24" color="accent"></mat-spinner>
      } @else {
        <mat-icon>send</mat-icon>
      }
    </button>
  </footer>
</div>

